{"version":3,"file":"plugin.cjs","sources":["../../../src/resolve-virtual-entries-plugin/plugin.ts"],"sourcesContent":["import path from 'node:path'\nimport * as vite from 'vite'\nimport type {\n  TanStackStartOutputConfig,\n  TanStackStartVitePluginCoreOptions,\n} from '../plugin'\n\nexport function resolveVirtualEntriesPlugin(\n  opts: TanStackStartVitePluginCoreOptions,\n  startConfig: TanStackStartOutputConfig,\n): vite.Plugin {\n  let resolvedConfig: vite.ResolvedConfig\n\n  const modules = new Set<string>([\n    '/~start/server-entry',\n    '/~start/default-server-entry',\n    '/~start/default-client-entry',\n  ])\n\n  return {\n    name: 'tanstack-start-core:resolve-virtual-entries',\n    configResolved(config) {\n      resolvedConfig = config\n    },\n    resolveId(id) {\n      if (modules.has(id)) {\n        return `${id}.tsx`\n      }\n\n      return undefined\n    },\n    load(id) {\n      const routerFilepath = vite.normalizePath(\n        path.resolve(startConfig.root, startConfig.tsr.srcDirectory, 'router'),\n      )\n\n      if (id === '/~start/server-entry.tsx') {\n        const ssrEntryFilepath = startConfig.serverEntryPath.startsWith(\n          '/~start/default-server-entry',\n        )\n          ? startConfig.serverEntryPath\n          : vite.normalizePath(\n              path.resolve(resolvedConfig.root, startConfig.serverEntryPath),\n            )\n\n        return opts.getVirtualServerRootHandler({\n          routerFilepath,\n          serverEntryFilepath: ssrEntryFilepath,\n        })\n      }\n\n      if (id === '/~start/default-client-entry.tsx') {\n        return opts.getVirtualClientEntry({ routerFilepath })\n      }\n\n      if (id === '/~start/default-server-entry.tsx') {\n        return opts.getVirtualServerEntry({ routerFilepath })\n      }\n\n      return undefined\n    },\n  }\n}\n"],"names":["vite"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAOgB,SAAA,4BACd,MACA,aACa;AACT,MAAA;AAEE,QAAA,8BAAc,IAAY;AAAA,IAC9B;AAAA,IACA;AAAA,IACA;AAAA,EAAA,CACD;AAEM,SAAA;AAAA,IACL,MAAM;AAAA,IACN,eAAe,QAAQ;AACJ,uBAAA;AAAA,IACnB;AAAA,IACA,UAAU,IAAI;AACR,UAAA,QAAQ,IAAI,EAAE,GAAG;AACnB,eAAO,GAAG,EAAE;AAAA,MAAA;AAGP,aAAA;AAAA,IACT;AAAA,IACA,KAAK,IAAI;AACP,YAAM,iBAAiBA,gBAAK;AAAA,QAC1B,KAAK,QAAQ,YAAY,MAAM,YAAY,IAAI,cAAc,QAAQ;AAAA,MACvE;AAEA,UAAI,OAAO,4BAA4B;AAC/B,cAAA,mBAAmB,YAAY,gBAAgB;AAAA,UACnD;AAAA,QAAA,IAEE,YAAY,kBACZA,gBAAK;AAAA,UACH,KAAK,QAAQ,eAAe,MAAM,YAAY,eAAe;AAAA,QAC/D;AAEJ,eAAO,KAAK,4BAA4B;AAAA,UACtC;AAAA,UACA,qBAAqB;AAAA,QAAA,CACtB;AAAA,MAAA;AAGH,UAAI,OAAO,oCAAoC;AAC7C,eAAO,KAAK,sBAAsB,EAAE,gBAAgB;AAAA,MAAA;AAGtD,UAAI,OAAO,oCAAoC;AAC7C,eAAO,KAAK,sBAAsB,EAAE,gBAAgB;AAAA,MAAA;AAG/C,aAAA;AAAA,IAAA;AAAA,EAEX;AACF;;"}